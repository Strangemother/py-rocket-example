async version of the proc code.